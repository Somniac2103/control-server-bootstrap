---
- name: Bootstrap control server - Clone control repo
  hosts: 127.0.0.1
  connection: local
  gather_facts: no
  vars_files:
    - group_vars/all.yml

  tasks:
    - name: Ensure git is installed
      apt:
        name: git
        state: present
      become: yes

    - name: Create destination directory
      file:
        path: "{{ repo_dest }}"
        state: directory
        mode: '0755'
        recurse: yes

    - name: Clone or update control repo
      git:
        repo: "{{ repo_url }}"
        dest: "{{ repo_dest }}"
        version: "{{ repo_branch }}"
        force: yes
    
    - name: Print confirmation message
      debug:
        msg: "Cron job ran successfully at {{ ansible_date_time.iso8601 }}"
