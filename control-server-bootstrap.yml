---
- name: Bootstrap control server - Clone control repo
  hosts: 127.0.0.1
  connection: local
  gather_facts: no
  vars_files:
    - group_vars/all.yml

  tasks:
    - name: Ensure git is installed
      apt:
        name: git
        state: present
      become: yes

    - name: Create destination directory
      file:
        path: "{{ repo_dest }}"
        state: directory
        mode: '0755'
        recurse: yes

    - name: Clone or update control repo
      git:
        repo: "{{ repo_url }}"
        dest: "{{ repo_dest }}"
        version: "{{ repo_branch }}"
        force: yes

 # --- RUN ADMIN & CRON ROLES ---

- name: Run system admin tasks and cron jobs
  hosts: 127.0.0.1
  connection: local
  gather_facts: false
  become: true
  vars_files:
    - group_vars/system_admin.yml
    - group_vars/cron_jobs.yml
  roles:
    - system_admin_tasks
    - cron_jobs

# --- OPTIONAL: FINAL CONFIRMATION MESSAGE ---

- name: Confirm playbook execution time
  hosts: 127.0.0.1
  connection: local
  gather_facts: true
  tasks:
    - name: Print confirmation message
      debug:
        msg: "Control playbook ran successfully at {{ ansible_date_time.iso8601 }}"